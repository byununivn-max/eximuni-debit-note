# EXIMUNI Debit Note System - 사용 가이드

## 📌 접속 정보

| 항목 | 내용 |
|------|------|
| **외부 접속 URL** | https://elvera-unoutlawed-guardedly.ngrok-free.dev |
| **내부 접속 URL** | http://localhost:3001 |

> **참고:** 외부 URL 접속 시 ngrok 보안 화면이 나타날 수 있습니다. "Visit Site" 버튼을 클릭하면 됩니다.

---

## 🔐 1. 로그인

### 테스트 계정

| 역할 | 아이디 | 비밀번호 | 권한 설명 |
|------|--------|----------|-----------|
| **관리자** | `admin` | `admin123` | 모든 기능 사용 가능 (거래처/사용자 관리 포함) |
| **회계담당** | `accountant1` | `account123` | 거래 데이터 입력, Debit Note 생성/제출 |
| **현장담당** | `pic1` | `pic123` | 거래 데이터 입력, Debit Note 승인/거절 |

### 로그인 방법
1. 접속 URL을 브라우저에 입력
2. 로그인 화면에서 아이디/비밀번호 입력
3. **로그인** 버튼 클릭

---

## 📊 2. Dashboard (대시보드)

로그인 후 첫 화면입니다.

**표시 정보:**
- 미승인 Debit Note 건수
- 초안(Draft) 건수
- 승인된 청구액 합계 (VND)
- 등록 거래처 수
- 최근 Debit Note 목록

---

## 👥 3. 거래처 관리

**메뉴:** 좌측 사이드바 → **거래처 관리**

### 거래처 등록
1. 우측 상단 **거래처 등록** 버튼 클릭
2. 필수 입력:
   - **거래처 코드**: 영문 코드 (예: `NEXCON`, `SAMSUNG`)
   - **거래처명**: 정식 명칭 (예: `NEXCON VIETNAM CO., LTD`)
3. 선택 입력: 영문명, 통화(VND/USD/Mixed), 복잡도, 담당자, 이메일, 메모
4. **저장** 클릭

### 거래처 수정
- 목록에서 해당 거래처의 **수정** 버튼 클릭
- 정보 변경 후 **저장**

---

## 📦 4. 거래 데이터 (Shipments)

**메뉴:** 좌측 사이드바 → **거래 데이터**

### 거래 등록
1. 우측 상단 **거래 등록** 버튼 클릭
2. 기본 정보 입력:
   - **거래처** (필수): 드롭다운에서 선택
   - **유형** (필수): IMPORT 또는 EXPORT
   - **선적일**: 날짜 선택
   - **Invoice No.**: 인보이스 번호
   - **Term**: FOB, EXW, DAP, CIF, CFR, DDP 중 선택
   - **MBL / HBL**: 선하증권 번호
   - **CD No.**: 통관 번호
   - **포장수 / 총중량**: 수치 입력
3. 비용 항목 추가:
   - **비용 항목 추가** 버튼 클릭
   - 비용 항목을 드롭다운에서 선택 (예: Ocean Freight, Trucking 등)
   - USD 금액 입력
   - 여러 비용 항목을 추가 가능
4. **등록** 클릭

### 거래처별 필터
- 상단 **거래처 필터** 드롭다운에서 특정 거래처 선택 시 해당 건만 표시

### 중복 감지
- 동일한 Invoice No. 또는 MBL/HBL로 등록 시 ⚠️ 중복 경고 표시
- 중복이어도 등록은 됩니다 (경고 확인 후 진행)

---

## 💱 5. 환율 관리

**메뉴:** 좌측 사이드바 → **환율 관리**

### 환율 등록
1. 우측 상단 **환율 등록** 버튼 클릭
2. 입력:
   - **기준일**: 날짜 선택
   - **환율 (VND/USD)**: 예) `25,400`
3. **등록** 클릭

> 최상단에 **최신 환율**이 카드로 표시됩니다. Debit Note 생성 시 이 환율이 자동으로 적용됩니다.

---

## 📄 6. Debit Note (핵심 기능)

**메뉴:** 좌측 사이드바 → **Debit Note**

### 6-1. Debit Note 생성

1. 우측 상단 **Debit Note 생성** 버튼 클릭
2. 입력:
   - **거래처** (필수): 드롭다운에서 선택
   - **청구 기간** (필수): 시작일 ~ 종료일 선택
   - **환율** (필수): 자동으로 최신 환율이 입력됨 (수정 가능)
   - **시트 유형**: ALL(전체), IMPORT, EXPORT 중 선택
   - **메모**: 필요 시 입력
3. **생성** 클릭

> 시스템이 자동으로 해당 거래처의 해당 기간 거래 데이터를 모아서 Debit Note를 생성합니다.

### 6-2. Debit Note 상태 흐름

```
DRAFT → PENDING_REVIEW → APPROVED → EXPORTED
                       ↘ REJECTED
```

| 상태 | 설명 | 다음 액션 |
|------|------|-----------|
| **DRAFT** (초안) | 생성 직후 상태 | 검토 제출 가능 |
| **PENDING_REVIEW** (검토중) | 검토 대기 중 | 승인 또는 거절 가능 |
| **APPROVED** (승인) | 승인 완료 | Excel 출력 가능 |
| **REJECTED** (거절) | 거절됨 | - |
| **EXPORTED** (출력완료) | Excel 다운로드 완료 | 재다운로드 가능 |

### 6-3. 상세 조회

- 목록에서 **상세** 버튼 클릭
- DN 번호, 거래처, 기간, 환율, USD/VND 합계, VAT, 최종 합계 확인
- 하단에 **라인 항목** 상세 (각 Shipment별 비용 내역)

### 6-4. 검토 제출 (DRAFT → PENDING_REVIEW)

1. 상세 화면에서 **검토 제출** 버튼 클릭
2. 확인 팝업에서 확인

### 6-5. 승인 / 거절 (PENDING_REVIEW → APPROVED / REJECTED)

> **중요:** 본인이 생성한 Debit Note는 본인이 승인할 수 없습니다. 다른 사용자가 승인해야 합니다.

**테스트 방법:**
1. `accountant1`으로 로그인하여 Debit Note 생성 → 검토 제출
2. 로그아웃 후 `pic1` 또는 `admin`으로 로그인
3. 해당 Debit Note 상세에서 **승인** 또는 **거절** 클릭

### 6-6. Excel 출력 (APPROVED/EXPORTED 상태)

- 목록에서 초록색 **Excel** 버튼 클릭 또는
- 상세 화면에서 **Excel 다운로드** 클릭
- `.xlsx` 파일이 자동 다운로드됩니다

**Excel 파일 내용:**
- IMPORT 시트 / EXPORT 시트 (시트 유형에 따라)
- 각 Shipment별 비용 상세
- VND 환산 금액, VAT, 최종 합계
- 합계 행 자동 계산

### 6-7. 워크플로우 이력

- 목록에서 **이력** 버튼 클릭
- 해당 Debit Note의 상태 변경 이력을 타임라인으로 확인

---

## 🔄 7. 테스트 시나리오 (권장 순서)

### 시나리오 A: 기본 흐름 (Full Cycle)

1. **`admin`으로 로그인**
2. **거래처 등록**: 거래처 관리 → 거래처 등록 → 코드: `TEST01`, 이름: `테스트 회사`
3. **환율 등록**: 환율 관리 → 환율 등록 → 오늘 날짜, 환율: `25,400`
4. **로그아웃** → **`accountant1`으로 로그인**
5. **거래 등록** (3건 정도):
   - 거래 데이터 → 거래 등록
   - 거래처: TEST01, 유형: IMPORT, Invoice: INV-001
   - 비용 항목 추가: Ocean Freight $500, Trucking $100
   - 나머지 2건도 다른 Invoice로 등록
6. **Debit Note 생성**:
   - Debit Note → Debit Note 생성
   - 거래처: TEST01, 기간: 이번 달 1일~말일
   - 환율 자동 입력 확인 → 생성
7. **검토 제출**: 상세 → 검토 제출
8. **로그아웃** → **`pic1`으로 로그인**
9. **승인**: 해당 DN 상세 → 승인
10. **Excel 다운로드**: Excel 버튼 클릭 → 파일 확인

### 시나리오 B: 거절 흐름

1. `accountant1`으로 거래 등록 + Debit Note 생성 + 검토 제출
2. `pic1`으로 로그인 → 해당 DN **거절**
3. 이력 확인 → 거절 내역 표시 확인

### 시나리오 C: 중복 감지

1. 아무 계정으로 로그인
2. 거래 데이터 → 거래 등록 → MBL: `TESTMBL001`로 등록
3. 같은 MBL로 다시 등록 → ⚠️ 중복 경고 확인

---

## ❓ FAQ

**Q: 외부 URL 접속 시 "Visit Site" 화면이 나타나요**
A: ngrok 보안 화면입니다. "Visit Site" 버튼을 클릭하면 정상 접속됩니다.

**Q: Debit Note 생성 시 "라인 항목 0건"이 나와요**
A: 선택한 거래처/기간에 해당하는 거래 데이터가 없는 경우입니다. 먼저 거래 데이터를 등록하세요.

**Q: 내가 만든 Debit Note를 내가 승인할 수 없어요**
A: 보안 정책상 본인이 생성한 DN은 다른 사용자만 승인할 수 있습니다. 다른 계정으로 로그인하세요.

**Q: Excel 파일이 다운로드되지 않아요**
A: APPROVED 또는 EXPORTED 상태에서만 Excel 출력이 가능합니다. 먼저 승인 절차를 완료하세요.

**Q: 비용 항목 드롭다운이 비어 있어요**
A: 시스템에 비용 항목(Fee Items)이 등록되어 있어야 합니다. 관리자에게 문의하세요.

---

## 🛠 기술 지원

문제가 발생하면 다음 정보와 함께 보고해 주세요:
- 접속 계정 (admin / accountant1 / pic1)
- 발생 화면 (어느 페이지에서)
- 에러 메시지 (화면 캡처)
- 수행하려던 작업 내용
